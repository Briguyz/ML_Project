---
title: "adjustforinflation"
author: "Kyra Hendrickson"
date: "2022-11-4"
output: html_document
---


---
notes

This file calculates an adjusted budget and revenue for inflation column (starts on line 73)
and outputs movies_filtered.csv with the updated budget and revenue (updated for yrs<2021).

Did a sanity check on routine and the numbers looks reasonable. Also ran the routine for 
some 2021 movies and they all gave the same values which checks out. 

Assumed budget and revenue were in USD in our dataframe
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Imports (didnt use all of these just copy and pasted imports from another file)
```{r}
library(tidyverse)
library(readr)
library(knitr)
library(kableExtra)
library(caret)
library(klaR)
```

--
Download data
--
```{r}
movies_filtered <- read_csv('movies_filtered.csv', col_names =c('title','genres','original_language','production_companies','release_date','budget','revenue','vote_average','vote_count','credits'), trim_ws = TRUE, show_col_types = FALSE)

movies_filtered <- movies_filtered[-c(1), ]
```

```{r}
data <- write_excel_csv(movies_filtered, "pleasework.csv")
```



```{r}
if(!require('PriceR')){
  install.packages('priceR')
  library('priceR')
}
```

```{r}
# set country
country <- "US"
inflation_dataframe <- retrieve_inflation_data(country)
countries_dataframe <- show_countries() 

# get budget and revenue vector
budget <- as.numeric(unlist(movies_filtered[6]))
revenue <- as.numeric(unlist(movies_filtered[7]))
fromdates <- as.numeric(unlist(movies_filtered[5]))
todate = 2021
```

For loop only works starting at 2020 movies. It draws from inflation data that goes up to 2021. T
Movies are in yearly order from newest to oldest and the first instance of 2020 is on index 221. 
Start here and just bind what you got to budget[1:220,] and revenue[1:220]

```{r}
## budgets starting with index 221. 

adjusted_budget <- vector(mode="numeric")
for (i in 221:8852){
  new_prices <- adjust_for_inflation(budget[i], fromdates[i], country, todate,
    inflation_dataframe = inflation_dataframe,
    countries_dataframe = countries_dataframe)
  adjusted_budget <- append(adjusted_budget, new_prices)
}

# new budget vector
new_budget <- as.character(append(budget[1:220],adjusted_budget))
```

```{r}
## revenue starting with index 221 (Movie: Soul). On Movies filtered, Soul is index 220. 

adjusted_revenue <- vector(mode="numeric")
for (i in 221:8852){
  new_prices <- adjust_for_inflation(revenue[i], fromdates[i], country, todate,
    inflation_dataframe = inflation_dataframe,
    countries_dataframe = countries_dataframe)
  adjusted_revenue <- append(adjusted_revenue, new_prices)
}

# new revenue vector
new_revenue <- as.character(append(revenue[1:220],adjusted_revenue))
```


```{r}
## update movies_filtered and save as movies_filtered_inflAdj
movies_filtered$budget <- new_budget 
movies_filtered$revenue <- new_revenue 
```

```{r}
whatnow <- movies_filtered$budget
whatnow2 <- movies_filtered$revenue
whatnow3 <- movies_filtered$vote_average
```


```{r}
data <- write_excel_csv(movies_filtered, "movies_filtered_adjInfl.csv")
```


